<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Analyst Jerry – Repository Index</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; line-height: 1.6; }
    h1 { text-align: center; margin-bottom: 0.25rem; }
    .sub { text-align: center; color: #555; margin-top: 0; }
    details { margin: .25rem 0 .25rem 1rem; }
    ul { list-style: none; padding-left: 1rem; margin: 0.25rem 0; }
    li { margin: .2rem 0; }
    a { text-decoration: none; }
    a:hover { text-decoration: underline; }
    .muted { color:#666 }
    .err { color: #b00020; font-weight: 600; }
    .note { background:#f6f8fa; border:1px solid #e1e4e8; border-radius:8px; padding:.5rem .75rem; margin:1rem 0; }
  </style>
</head>
<body>
  <h1>📂 Analyst Jerry</h1>
  <p class="sub">Auto-generated index of files in this repository</p>
  <div class="note">Tip: Files link directly from this site (e.g., <code>.html</code>) or open as plain text (e.g., <code>.sql</code>).</div>

  <div id="app">Loading…</div>

  <script>
    const user = "AnalystJerry";
    const repo = "AnalystJerry.github.io";

    // Hide these from the list if you want:
    const HIDE_NAMES = new Set(["index.html", ".gitignore", "README.md"]);

    async function fetchDir(path = "") {
      const url = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`GitHub API error ${res.status} for ${url}`);
      return res.json(); // array of {name,path,type,download_url}
    }

    function makeLinkItem(item) {
      const li = document.createElement("li");
      if (HIDE_NAMES.has(item.name)) return null;
      const a = document.createElement("a");
      a.href = encodeURI(item.path); // serve directly from Pages
      a.textContent = item.name;
      li.appendChild(a);
      return li;
    }

    async function renderDir(container, path = "") {
      const entries = await fetchDir(path);
      // Folders first, then files
      const dirs = entries.filter(e => e.type === "dir").sort((a,b)=>a.name.localeCompare(b.name));
      const files = entries.filter(e => e.type === "file").sort((a,b)=>a.name.localeCompare(b.name));

      // Files
      if (files.length) {
        const ul = document.createElement("ul");
        for (const f of files) {
          const li = makeLinkItem(f);
          if (li) ul.appendChild(li);
        }
        container.appendChild(ul);
      }

      // Directories
      for (const d of dirs) {
        if (HIDE_NAMES.has(d.name)) continue;
        const details = document.createElement("details");
        const summary = document.createElement("summary");
        summary.textContent = `📁 ${d.name}`;
        details.appendChild(summary);
        container.appendChild(details);

        const inner = document.createElement("div");
        details.appendChild(inner);

        try {
          await renderDir(inner, d.path);
        } catch (err) {
          const p = document.createElement("p");
          p.className = "err";
          p.textContent = `Could not load ${d.path}: ${err.message}`;
          inner.appendChild(p);
        }
      }

      if (!dirs.length && !files.length) {
        const p = document.createElement("p");
        p.className = "muted";
        p.textContent = "(empty)";
        container.appendChild(p);
      }
    }

    (async () => {
      const app = document.getElementById("app");
      try {
        await renderDir(app, "");
      } catch (e) {
        app.innerHTML = `<p class="err">Failed to load repository contents. ${e.message}</p>
                         <p class="muted">If this is a private repo, make it public or replace API listing with manual links.</p>`;
      }
    })();
  </script>
</body>
</html>
